# AgroVision Configuration
# This file controls paths, band selection, and class definitions

# =============================================================================
# Paths
# =============================================================================
paths:
  data_raw: data/agrifieldnet
  data_processed: data/processed
  splits_dir: data/splits
  model_checkpoint: outputs/models/unet_baseline_best_model.pth
  production_model_path: outputs/models/unet_baseline_best_model.pth

# =============================================================================
# Model Settings
# =============================================================================
model:
  # Required for deterministic production loading
  name: unet_baseline
  in_channels: 12
  num_classes: 14

  # Runtime/inference settings
  device: cuda
  tile_limit: 9
  input_size: 256

# =============================================================================
# Backend Settings
# =============================================================================
backend:
  demo_split: val
  demo_tile_index: 0
  overlay_alpha: 0.45
  sentinel2_stac_url: "https://planetarycomputer.microsoft.com/api/stac/v1"
  sentinel2_collection: "sentinel-2-l2a"
  sentinel2_date_window: "2023-01-01/2024-12-31"
  sentinel2_cloud_cover: 60
  sentinel2_max_items: 10
  sentinel2_scale: 0.01

# =============================================================================
# Training Settings
# =============================================================================
training:
  batch_size: 32
  num_workers: 2  # for colab
  val_split: 0.2
  random_seed: 42
  epochs: 50

  # Loss configuration
  # AgriFieldNet is pixel-labeled but challenge scoring is per-field.
  # Field loss aligns training with scoring; pixel loss keeps overlays correct.
  use_field_loss: true
  lambda_pixel: 0.2           # Weight for pixel-level loss (overlay quality)
  lambda_field: 1.0           # Weight for field-level loss (main driver)

  # Masking and class weighting
  ignore_index: 0             # Class 0 is unlabeled/background - IGNORE in pixel loss
  min_labeled_fraction: 0.001 # Skip batches with <0.1% labeled pixels
  background_weight: 0.0      # Set to 0 since background is ignored anyway
  focal_gamma: 2.0            # Focal loss focusing parameter

  # Weighted tile sampling
  use_weighted_sampling: true # Oversample tiles with more labeled pixels
  weight_power: 1.5           # Preference strength (higher = stronger preference)

  # Optimizer
  learning_rate: 0.0003
  weight_decay: 0.0001
  optimizer: adamw

  # Model selection criterion: "field_ce" (lower is better) or "mIoU" (higher is better)
  model_selection: field_ce

# =============================================================================
# Sentinel-2 Band Configuration (all 12 bands)
# =============================================================================
bands:
  # Band name, wavelength (nm), native resolution, description
  - name: B01
    wavelength: 443
    resolution: 60
    description: Coastal Aerosol
  - name: B02
    wavelength: 490
    resolution: 10
    description: Blue
  - name: B03
    wavelength: 560
    resolution: 10
    description: Green
  - name: B04
    wavelength: 665
    resolution: 10
    description: Red
  - name: B05
    wavelength: 705
    resolution: 20
    description: Red Edge 1
  - name: B06
    wavelength: 740
    resolution: 20
    description: Red Edge 2
  - name: B07
    wavelength: 783
    resolution: 20
    description: Red Edge 3
  - name: B08
    wavelength: 842
    resolution: 10
    description: NIR
  - name: B8A
    wavelength: 865
    resolution: 20
    description: NIR Narrow
  - name: B09
    wavelength: 945
    resolution: 60
    description: Water Vapor
  - name: B11
    wavelength: 1610
    resolution: 20
    description: SWIR 1
  - name: B12
    wavelength: 2190
    resolution: 20
    description: SWIR 2

# =============================================================================
# Crop Class Definitions (13 crops + background)
# =============================================================================
classes:
  0:
    name: Background
    name_ar: خلفية
    color: [0, 0, 0]
  1:
    name: Wheat
    name_ar: قمح
    color: [255, 200, 0]
  2:
    name: Mustard
    name_ar: خردل
    color: [255, 150, 0]
  3:
    name: Lentil
    name_ar: عدس
    color: [200, 100, 50]
  4:
    name: No Crop
    name_ar: بور
    color: [128, 128, 128]
  5:
    name: Green Pea
    name_ar: بسلة خضراء
    color: [0, 200, 0]
  6:
    name: Sugarcane
    name_ar: قصب السكر
    color: [100, 200, 100]
  8:
    name: Garlic
    name_ar: ثوم
    color: [200, 150, 200]
  9:
    name: Maize
    name_ar: ذرة صفراء
    color: [255, 255, 0]
  13:
    name: Gram
    name_ar: حمص
    color: [150, 100, 50]
  14:
    name: Coriander
    name_ar: كزبرة
    color: [0, 150, 100]
  15:
    name: Potato
    name_ar: بطاطس
    color: [200, 150, 100]
  16:
    name: Berseem
    name_ar: برسيم
    color: [0, 255, 150]
  36:
    name: Rice
    name_ar: أرز
    color: [0, 100, 255]

# =============================================================================
# Normalization (computed from training data, stored after prepare_dataset.py)
# =============================================================================
# normalization_stats will be saved to data/processed/normalization_stats.json
